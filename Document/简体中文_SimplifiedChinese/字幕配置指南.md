# JustAnotherTranslator 字幕配置指南

本文档将说明如何为 JustAnotherTranslator（JAT）插件设置字幕样式。

欢迎提交任何改进和修复

仓库地址:  https://github.com/MeidoPromotionAssociation/COM3D2.JustAnotherTranslator.Plugin

请先查看 [README](https://github.com/MeidoPromotionAssociation/COM3D2.JustAnotherTranslator.Plugin) 文件，了解 JAT 的基本使用方法、配置文件路径，如何在游戏内调整设置等。

# 字幕样式

字幕使用 Unity uGUI 的 Text 组件实现，它支持富文本显示。

具体可参考 Unity 文档：https://docs.unity3d.com/Packages/com.unity.ugui@1.0/manual/StyledText.html

显示字幕时，译文会原样传递给 Text 组件，因此如果您在其中使用了富文本标记，则会有对应的效果，不过不能保证 100% 兼容。

## 通用样式

以下所有样式选项均可为 `基础字幕`、`ADV字幕`、`夜伽字幕`、`歌词字幕` 四种类型分别进行配置。

- `字体 (Font)`: 设置字幕所使用的字体。您需要输入系统中已安装字体的名称。如果字体未找到，将使用默认的 Arial 字体。
- `字体大小 (FontSize)`: 设置字幕的字体大小。
- `文本对齐 (TextAlignment)`: 设置文本在字幕框内的对齐方式。可选值包括左上、上中、右上、中左、正中、中右、左下、下中、右下。
- `文本颜色 (TextColor)`: 设置文本的颜色，使用十六进制颜色码，例如 `#FFFFFF` 代表白色。
- `文本不透明度 (TextOpacity)`: 设置文本的不透明度，范围从 0 (完全透明) 到 1 (完全不透明)。
- `背景颜色 (BackgroundColor)`: 设置字幕背景框的颜色，使用十六进制颜色码。
- `背景不透明度 (BackgroundOpacity)`: 设置字幕背景框的不透明度。
- `启用描边 (EnableOutline)`: 是否为文本启用描边效果。
- `描边颜色 (OutlineColor)`: 设置文本描边的颜色，使用十六进制颜色码，例如 `#000000` 代表黑色。
- `描边不透明度 (OutlineOpacity)`: 设置文本描边的不透明度，范围从 0 (完全透明) 到 1 (完全不透明)。
- `描边宽度 (OutlineWidth)`: 设置文本描边的宽度。单位：像素（桌面模式）。在 VR 模式下会根据字体缩放自动换算为世界空间大小，无需手动换算。
- `启用动画 (EnableAnimation)`: 是否启用字幕的淡入淡出动画效果。
- `淡入时长 (FadeInDuration)`: 字幕淡入动画的持续时间（秒）。
- `淡出时长 (FadeOutDuration)`: 字幕淡出动画的持续时间（秒）。
- `启用说话人 (EnableSpeakerName)`: 是否在字幕中显示说话人的名字。

VR 中依然遵守这些配置。

### 关于说话人名字颜色

说话人名字颜色会在该角色首次显示字幕时由插件根据人名自动生成，不同的名字会获得不同的颜色。

相同名字得出的颜色始终相同，但由于运行时不同，当游戏更改 Unity 版本时可能会得到不一样的结果。

当插件生成颜色过后，会生成一个配置文件并持久化到 `COM3D2\BepInEx\JustAnotherTranslator\SpeakerColor.json`，然后您就可以自行更改说话者的名字颜色。

文件格式为
```json
{
  "说话者名称1": "#RRGGBB",
  "说话者名称2": "#RRGGBB"
}
```
#RRGGBB 为 16 进制颜色代码

例如
```json
{
  "一条 留依": "#FCD5DE",
  "Kurita Kasumi": "#C7CEC1"
}
```

说话者名称和插件配置中的 `MaidNameStyle/女仆名字样式` 有关，该配置项决定姓名的前后顺序。

若重名，则重名角色颜色相同。

该配置文件会在游戏内使用 BepInEx.ConfigurationManager 开关 `EnableBaseSubtitle/启用基础字幕` 选项后热重载。

关于配置文件，请查看`翻译指南`。

# 字幕位置

## 桌面模式

想象有一个虚拟的屏幕（Canvas）覆盖在您的屏幕上，它的参考分辨率是 1920x1080，比率 16:9。

（参考分辨率不影响显示效果，它只是尺寸参考，会随着屏幕分辨率自动缩放。）

- 如果您的屏幕是 16:9 屏幕，那么虚拟屏幕的分辨率始终为参考分辨率 1920x1080。
- 如果您是带鱼屏等非 16:9 屏幕，为了保证字幕默认可见，参考分辨率会优先匹配高度。
    - 即虚拟屏幕高度恒定为 1080，而参考宽度则会根据缩放因子变大或变小，请根据实际需要调整字幕宽度。
    - 假如你的分辨率是 3440×1440，那么：
    - 缩放因子 = 屏幕高度 ÷ 参考高度 = 1440 ÷ 1080 = 1.3333
    - 虚拟屏幕宽度 = 屏幕宽度 ÷ 缩放因子 = 3440 ÷ 1.3333 = 2580

字幕尺寸和位置都是相对于虚拟屏幕的。

字幕是一个矩形框，它的控制点在左下角。

- `字幕水平位置 (HorizontalPosition)` 设置的是矩形框左边到虚拟屏幕左边的距离，0 为屏幕最左边，因为参考分辨率是 1920，所以屏幕最右边会是 1920（如果屏幕不是16:9会有所变化，请查看上一节）
    - 设置为 1920 时字幕会超出屏幕
- `字幕垂直位置 (VerticalPosition)` 设置的是矩形框底边到虚拟屏幕底部的距离，0 为屏幕最底部，因为参考分辨率是 1080，所以屏幕最上边会是 1080
    - 设置为 1080 时字幕会理论上会超出屏幕，不过 JAT 会自动将高度钳制在 `0` 到 `1080 - 字幕高度` 之间，因此即便设置超过了 `1080 - 字幕高度` 还是会等于 `1080 - 字幕高度`
- `字幕高度 (SubtitleHeight)` 设置的是字幕矩形框的高度，也是相对于虚拟屏幕分辨率的，设置为 30 就是 30 虚拟像素高，实际显示时会根据屏幕大小进行缩放。
- `字幕宽度 (SubtitleWidth)` 设置的是字幕矩形框的宽度，也是相对于虚拟屏幕分辨率的，设置为 1920 就是 1920 虚拟像素宽，实际显示时会根据屏幕大小进行缩放。

## VR 平板电脑模式

在 VR 模式中，原有的游戏 UI 会被放置到一个虚拟平板电脑上。

想象有一个透明的虚拟的屏幕覆盖在您的屏幕上，但它并不在平板电脑的屏幕内，而是可以自由移动，可以超出平板电脑，但它始终跟随平板电脑。

字幕是一个矩形框，它的控制点在正中央。

- `字幕水平位置 (HorizontalPosition)` 设置的是字幕矩形框中央相对于平板电脑中央的位置，0为平板电脑正中央，数值越大越往右，假如设置为 -0.02，就是字幕矩形框中央从平板电脑中央向左移动 0.02 米
- `字幕垂直位置 (VerticalPosition)` 设置的是字幕矩形框中央相对于平板电脑中央的位置，0为平板电脑正中央，数值越大越往上，假如设置为 0.17，就是字幕矩形框中央从平板电脑中央向上移动 0.17 米
- `字幕高度 (SubtitleHeight)` 设置的是字幕矩形框的高度，1000 单位 = 1 米，假如设置为 10 就是 0.01 米（1厘米）高。
- `字幕宽度 (SubtitleWidth)` 设置的是字幕矩形框的宽度，1000 单位 = 1 米，假如设置为 500 就是 0.5 米宽。
- `字体大小倍数 (TextSizeMultiplier)`：调整字幕大小，因为 VR 模式字幕缩放的关系，需要额外进行乘数。
- `描边缩放因子 (OutlineScaleFactor)`：调整描边宽度，因为 VR 模式字幕缩放的关系，需要额外进行乘数，若出现重影，请尝试调高此值。
- `像素完美 (PixelPerfect)`：是否启用像素对齐以减少模糊（WorldSpace 下效果有限）。

## VR 空间字幕模式

想象有一个虚拟的透明屏幕始终在你视线的正中央。

可以配置这个屏幕：距离你的眼睛有多远，垂直偏移多少度，水平偏移多少度。

字幕是一个矩形框，它的控制点在正中央。

- `字幕距离 (Distance)` 虚拟屏幕距离你的眼睛有多远，米
- `字幕垂直偏移 (VerticalOffset)` 虚拟屏幕相对你的眼睛垂直偏移多少度，正值向下
- `字幕水平偏移 (HorizontalOffset)` 虚拟屏幕相对你的眼睛水平偏移多少度，正值向右
- `字幕高度 (SubtitleHeight)` 设置的是字幕矩形框的高度，1000 单位 = 1 米，假如设置为 15 就是 0.015 米（1.5厘米）高。
- `字幕宽度 (SubtitleWidth)` 设置的是字幕矩形框的宽度，1000 单位 = 1 米，假如设置为 510 就是 0.51 米宽。
- `字体大小倍数 (TextSizeMultiplier)`：调整字幕大小，因为 VR 模式字幕缩放的关系，需要额外进行乘数。
- `描边缩放因子 (OutlineScaleFactor)`：调整描边宽度，因为 VR 模式字幕缩放的关系，需要额外进行乘数，若出现重影，请尝试调高此值。
- `像素完美 (PixelPerfect)`：是否启用像素对齐以减少模糊（WorldSpace 下效果有限）。
- `跟随平滑度 (FollowSmoothness)`：设置空间字幕跟随头部移动的平滑程度，数值越大跟踪越迅速（设置为 5 则约 0.6s 追上 95% 位移）。

# 字幕类型

JAT 将字幕分类为 4 种

- 基础字幕
- ADV字幕
- 夜伽字幕
- 歌词字幕

## 基础字幕

大部分情况都由此字幕负责，例如钓鱼小游戏、射击小游戏、VR 卡拉 OK 中的对话等。

（VR 卡拉 OK 模式指的是面前有个平板电脑的那个模式，与实际是否用 VR 设备玩无关）

## ADV字幕

日常对话时的字幕，通常不会显示。

## 夜伽字幕

夜伽的时候使用（可以选择技能那种）。

## 歌词字幕

只有官方舞蹈模式，和 VR 卡拉 OK 中的舞蹈使用此字幕，

# 字幕显示时机

请查看`翻译指南`